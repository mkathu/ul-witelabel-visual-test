name: trial
on:
  workflow_dispatch:
jobs:
  read-json:
    runs-on: ubuntu-latest
    steps:
      - name: setup npm
        uses: actions/checkout@v2
      - name: Read .json
        uses: juliangruber/read-file-action@v1
        id: budget
        with:
          path: .github/workflows/test-axe-core-url.json
    outputs:
          json_value: ${{toJSON(steps.budget.outputs.content) }}
  set-matrix: 
    runs-on: ubuntu-latest
    needs: read-json
    steps:
      - name: setup npm
        uses: actions/checkout@v2
      - name: Setup matrix combinations
        id: setup-matrix-combinations
        run: |
          echo ::set-output name=matrix-combinations::${{ needs.read-json.outputs.json_value }}
    outputs:
          matrix-combinations: ${{ steps.setup-matrix-combinations.outputs.matrix-combinations }}
          
  matrix-job:
    runs-on: ubuntu-latest
    needs: set-matrix
    strategy:
      matrix: ${{ fromJson(needs.set-matrix.outputs.matrix-combinations) }}
    steps:
      - name: setup npm
        uses: actions/checkout@v2
      - run: |
          npm install @axe-core/cli -g
          axe ${{matrix}} --load-delay=5000
